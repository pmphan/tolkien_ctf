# Writeup

## Before start

The hint page is located at `http://localhost:3000/hints`. This can be found after inspecting the front end source code.

## Flag 0

This is a [path traversal vulnerability via misconfigured nginx alias](https://www.acunetix.com/vulnerabilities/web/path-traversal-via-misconfigured-nginx-alias/).

Sending a request to `http://localhost:3000/images../run/secrets/flag` will return the flag.

Additionally, sending a request to `http://localhost:3000/images../run/secrets/jwtpublickey` will return the public key used by the backend server.

This flag is solved by the script `flag0.py` inside `solver` directory. The following command save the key into `jwt.pub` file.

```console
$ python flag0.py -o jwt.pub
```

Alternatively, just visiting the above URLs will do the job.

## Flag 1

This is a [JWT algorithm confusion attack](https://portswigger.net/web-security/jwt/algorithm-confusion). The server decode JWT token using both symmetric algorithm and assymetric algorithm. Using the previously obtained public key, it's easy to construct a fake JWT token with the admin email that the authentication server will accept using HS256 algorithm.

Solve this with `flag1.py` script as followed.

```console
$ python flag1.py jwt.pub
```

Alternatively, since the frontend code save the JWT token in Local Storage, we can simply replace the token in Local Storage with a new token, which can also be generated by the above script.

## Flag 2

This is a [Jinja Template Injection attack](https://www.onsecurity.io/blog/server-side-template-injection-with-jinja2/). Except the server has some filter in place to filter out inputs containing `{` and `[0-9"']|request|self|class|config|flag|builtin`. There are many ways to bypass this. The script in `flag2.py` suggests a possible payload.

```console
$ python flag2.py jwt.pub
```

Alternatively, input the suggested input into the search box and the flag should be printed in plaintext on the website.

The answer to the riddle is "mellon".
